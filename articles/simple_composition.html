<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simple Email Composition • blastula</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simple Email Composition">
<meta property="og:description" content="blastula">
<meta property="og:image" content="https://rich-iannone.github.io/blastula/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">blastula</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/simple_composition.html">Simple Email Composition</a>
    </li>
    <li>
      <a href="../articles/sending_using_smtp.html">Sending Email Using SMTP</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rich-iannone/blastula">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simple Email Composition</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rich-iannone/blastula/blob/master/vignettes/simple_composition.Rmd"><code>vignettes/simple_composition.Rmd</code></a></small>
      <div class="hidden name"><code>simple_composition.Rmd</code></div>

    </div>

    
    
<p>Before we get to the process of creating an HTML email message, it’s a good idea to learn about the model of such a message in <strong>blastula</strong>. Here is a diagram, and it doesn’t contain too many layout components (because simplicity in HTML email is a good thing).</p>
<p><br></p>
<p><img src="images/html_email_model.png" width="100%"></p>
<p><br></p>
<p>The main components (from top to bottom) are the <strong>header</strong>, the <strong>body</strong>, and the <strong>footer</strong>. The <strong>body</strong> content is inside of a wrapper that functions to differentiate the main content from whatever is in the <strong>header</strong> and <strong>footer</strong> (above and below the <strong>body</strong>).</p>
<p>Another thing to note is that the HTML used is responsive. Viewing the HTML in a viewport that is greater than or equal to 640 pixels will be different than seeing it with a viewport that’s smaller. This is important because email on mobile devices will often take on the latter view, which is optimized for smaller display widths (e.g., larger font sizes, decreased vertical space between elements, resized images, etc.).</p>
<p>When using <strong>blastula</strong>, we don’t have to worry much about either view since the API is designed to make emails look their best in both of them. Because we can preview the email message before sending it out, we have a chance to manually resize the browser and inspect the message in a variety of display widths.</p>
<div id="creating-a-simple-html-email-message" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-simple-html-email-message" class="anchor"></a>Creating a Simple HTML Email Message</h2>
<p>For those times where we’d only want to send a simple HTML email message, we can use the <code><a href="../reference/compose_email.html">compose_email()</a></code> function and focus on adding text content to the <strong>body</strong> component. So let’s create a simple email message using some plain text inside <code>body</code>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="../reference/compose_email.html">compose_email</a></span>(
  <span class="kw">body</span> <span class="kw">=</span>
<span class="st">"Hello,

I just wanted to let you know that the thing that you asked me for is ready to pick up. So, come over and do that.

Cheers
"</span>)</pre></body></html></div>
<p><img src="images/compose_simple-wide.png" width="100%"></p>
<p><img src="images/compose_simple-narrow.png" width="100%"></p>
<p align="center">
This is how it looks, depending on the display width (wide at top, narrow below that).
</p>
<p><br></p>
<p>A preview of the HTML email message should appear in the Viewer. Try resizing the Viewer to see how it responds to the different width thresholds.</p>
</div>
<div id="more-sophisticated-email-text" class="section level2">
<h2 class="hasAnchor">
<a href="#more-sophisticated-email-text" class="anchor"></a>More Sophisticated Email Text</h2>
<p>A good strategy for longer and more complicated text inputs is to use the <a href="https://glue.tidyverse.org"><strong>glue</strong></a> package. That package allows us to use string interpolation (and avoid the use of <code><a href="https://rdrr.io/r/base/paste.html">paste()</a></code> or <code><a href="https://rdrr.io/r/base/paste.html">paste0()</a></code>). Variables in the global workspace can be included in the curly braces of a <code>glue()</code> string expression, and, any <strong>R</strong> expressions in <code>{ }</code> will be evaluated.</p>
<p>We can include longer <strong>R</strong> statements inside of the curly braces (like <code>{paste0(format(Sys.time(), "%A, %B "), format(Sys.time(), "%d") %&gt;% as.numeric(), ", ", format(Sys.time(), "%Y"))}</code>), however, that would be unwieldy. It’s better to generate local variables with <strong>R</strong> statements and just use those variables inside the <code>{ }</code>.</p>
<p>Here is an example of the same email message body as in the last example, but using <strong>glue</strong> to preprocess our text:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">what</span> <span class="kw">&lt;-</span> <span class="st">"thing"</span>
<span class="no">salutation</span> <span class="kw">&lt;-</span> <span class="st">"Cheers"</span>

<span class="no">body_text</span> <span class="kw">&lt;-</span>
  <span class="fu">glue</span>(
    <span class="st">"
Hello,

I just wanted to let you know that the {what}
that you asked me for is ready to pick up. So,
come over and do that.

{salutation}
"</span>
  )

<span class="fu"><a href="../reference/compose_email.html">compose_email</a></span>(<span class="kw">body</span> <span class="kw">=</span> <span class="no">body_text</span>)</pre></body></html></div>
<p>Any literal quotation marks inside the braces should be escaped using a single <code>\</code>. Blank lines separating blocks of text result in new paragraphs.</p>
</div>
<div id="using-markdown-text-via-the-md-function" class="section level2">
<h2 class="hasAnchor">
<a href="#using-markdown-text-via-the-md-function" class="anchor"></a>Using Markdown Text via the <code>md()</code> Function</h2>
<p>Markdown text can be used as input for the <code>body</code>, <code>header</code>, and <code>footer</code> arguments. To opt into using Markdown formatting, call the <code><a href="../reference/md.html">md()</a></code> text helper function on any of these text elements. We can use the usual Markdown-formatting you know and you’ll get italicized text, bold text, lists, links, etc. Have a look at <a href="https://commonmark.org/help/">this reference page</a> to quickly understand how to use Markdown. The <strong>blastula</strong> package internally uses the <strong>commonmark</strong> <strong>R</strong> package to perform the conversion from Markdown to HTML.</p>
<p>A few notes on code style and options. It’s good to left-align the text in the code example since it will reduce the risk of having four or more spaces after a line break, which will result in <code>text like this</code> when using Markdown formatting through <code><a href="../reference/md.html">md()</a></code>.</p>
<p>In the next example, let’s first store the result of that statement in a local variable (<code>sending_date</code>). Then, the variable will be placed in the <strong>footer</strong> of the message (using the <code>footer</code> argument) along with leading text.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">#</span>
<span class="co"># Prepare the text inputs</span>
<span class="co">#</span>

<span class="no">sender_name</span> <span class="kw">&lt;-</span> <span class="st">"Shelly"</span>

<span class="no">sending_date</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(
    <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(), <span class="st">"%A, %B "</span>),
    <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(), <span class="st">"%d"</span>) <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(),
    <span class="st">", "</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/format.html">format</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span>(), <span class="st">"%Y"</span>)
  )

<span class="no">body_text</span> <span class="kw">&lt;-</span>
  <span class="fu">glue</span>(
    <span class="st">"
Hello,

I just wanted to let you know that the *thing* that
you asked me for is ready to pick up. So, come over
and do that.

Cheers,

{sender_name}
"</span>
  ) <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/md.html">md</a></span>()

<span class="no">footer_text</span> <span class="kw">&lt;-</span> <span class="fu">glue</span>(<span class="st">"Sent on {sending_date}."</span>)

<span class="co"># Compose the email message</span>
<span class="fu"><a href="../reference/compose_email.html">compose_email</a></span>(
  <span class="kw">body</span> <span class="kw">=</span> <span class="no">body_text</span>,
  <span class="kw">footer</span> <span class="kw">=</span> <span class="no">footer_text</span>
)</pre></body></html></div>
<p><img src="images/compose_interpolation_stmt-wide.png" width="100%"></p>
<p align="center">
Complicated string formatting goes into variables, the variables go into the email components
</p>
<p><br></p>
<p>Content in the <strong>footer</strong> and <strong>header</strong> sections is styled differently than <strong>body</strong> content (<strong>footer</strong> text will be somewhat smaller for one thing). The main message typically goes into the <strong>body</strong> whereas supplementary information works better in the <strong>footer</strong>.</p>
</div>
<div id="adding-an-external-image-to-an-html-email" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-an-external-image-to-an-html-email" class="anchor"></a>Adding an External Image to an HTML Email</h2>
<p>Although the rules for images in HTML email have changed often, the method that seems to work reasonably well these days is to use external images. There is a bit of upfront work in getting the image hosted somewhere but the payoff is fast page loads in email clients. The <strong>blastula</strong> package has a function which takes some of the pain out of getting images to a hosting service, it is the <code><a href="../reference/add_imgur_image.html">add_imgur_image()</a></code> function. <strong>Imgur</strong> is a fun site for sure (gifs galore!) but did you know that they have an API to make image uploading easy? They do, and this function takes advantage of that.</p>
<p>Here’s an example of an email that includes a local image that is deployed to <strong>Imgur</strong> (available at <a href="https://i.imgur.com/8uTB2Py.jpg" class="uri">https://i.imgur.com/8uTB2Py.jpg</a>) for indefinite hosting.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Send your image to Imgur with a Client Key;</span>
<span class="co"># the result is specially-crafted &lt;img&gt; tag</span>
<span class="co"># imgur_image &lt;-</span>
<span class="co">#   add_imgur_image(</span>
<span class="co">#     image = "rickenbacker_4001_1972_fireglo.jpg",</span>
<span class="co">#     client_id = "&lt;YOUR CLIENT ID&gt;"</span>
<span class="co">#   )</span>

<span class="co">#</span>
<span class="co"># Create the `body_text` and then the</span>
<span class="co"># email message with `compose_email()`</span>
<span class="co">#</span>

<span class="no">body_text</span> <span class="kw">&lt;-</span>
  <span class="fu">glue</span>(
    <span class="st">"
Hello,

I just wanted to let you know that the **1972 Rickenbacker
4001** is here to pick up. Here is a picture of it:

{imgur_image}

Cheers,

{sender_name}
"</span>
  ) <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/md.html">md</a></span>()

<span class="fu"><a href="../reference/compose_email.html">compose_email</a></span>(<span class="kw">body</span> <span class="kw">=</span> <span class="no">body_text</span>)</pre></body></html></div>
<p><img src="images/compose_imgur_local_image-wide.png" width="100%"></p>
<p align="center">
Once you get that Imgur Client ID, this is really easy
</p>
<p><br></p>
<p>This is how you get the all-important Client ID from <strong>Imgur</strong>. First, <a href="https://help.imgur.com/hc/en-us/articles/210076633-Create-an-Account">get an account with <strong>Imgur</strong></a>! Once that’s a thing accomplished, we can get the <code>Client-ID</code> key for the <strong>Imgur API</strong>. This can be easily done by going visiting <a href="https://api.imgur.com/oauth2/addclient">the API registration page</a> while signed-in to register an application. Give it a name—any name you can think of—and be sure to select the <code>OAuth 2 authorization type without a callback URL</code> radio button (the second in the list). After filling in the other necessary information bits and proving that you’re not a robot, you’ll receive the Client ID key! You’ll then have unfettered access to use any images, including animated gifs, in an HTML email message.</p>
<p>Wait, there’s more! Since this is <strong>R</strong> and we care about <strong>ggplot2</strong>, we can directly pass in a ggplot object to <code><a href="../reference/add_imgur_image.html">add_imgur_image()</a></code> and expect a nice ggplot image to appear in the email message. Here’s an example of how that works:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Create the plot data</span>
<span class="no">variety</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">LETTERS</span>[<span class="fl">1</span>:<span class="fl">7</span>], <span class="kw">each</span> <span class="kw">=</span> <span class="fl">40</span>)
<span class="no">treatment</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"high"</span>, <span class="st">"low"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">20</span>)
<span class="no">note</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>:<span class="fl">280</span>) + <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fl">150</span>, <span class="fl">280</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">variety</span>, <span class="no">treatment</span>, <span class="no">note</span>)

<span class="co"># Create the plot</span>
<span class="no">the_plot</span> <span class="kw">&lt;-</span>
  <span class="fu">ggplot</span>(<span class="no">data</span>, <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">variety</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">note</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="no">treatment</span>)) +
  <span class="fu">geom_boxplot</span>()

<span class="co"># Send your ggplot to Imgur with a Client Key;</span>
<span class="co"># again, you get an &lt;img&gt; tag that works for email</span>
<span class="co"># imgur_image &lt;-</span>
<span class="co">#   add_imgur_image(</span>
<span class="co">#     image = the_plot,</span>
<span class="co">#     client_id = "&lt;YOUR CLIENT ID&gt;"</span>
<span class="co">#   )</span>

<span class="co">#</span>
<span class="co"># Create the `body_text` and then the</span>
<span class="co"># email message with `compose_email()`</span>
<span class="co">#</span>

<span class="no">body_text</span> <span class="kw">&lt;-</span>
  <span class="fu">glue</span>(
    <span class="st">"
Hello,

I just wanted to let you know that the *ggplot* you \\
wanted to see is right here, in this email:

{imgur_image}

Cheers,

{sender_name}
"</span>
  ) <span class="kw">%&gt;%</span> <span class="fu"><a href="../reference/md.html">md</a></span>()

<span class="fu"><a href="../reference/compose_email.html">compose_email</a></span>(<span class="kw">body</span> <span class="kw">=</span> <span class="no">body_text</span>)</pre></body></html></div>
<p><img src="images/compose_imgur_ggplot-wide.png" width="100%"></p>
<p align="center">
A ggplot in your email message
</p>
<p><br></p>
<p>I don’t know about you but I’d love to get a ggplot in <em>my</em> email.</p>
</div>
<div id="wrapping-up" class="section level2">
<h2 class="hasAnchor">
<a href="#wrapping-up" class="anchor"></a>Wrapping Up</h2>
<p>We now know how to send really simple email messages with just some text, and, slightly more complex messages including those with images inside. <strong>Imgur</strong> really saves the day when it comes to hosting images as their API service is very permissive and getting access is not at all difficult!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Richard Iannone, Joe Cheng.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
